{% extends 'admins/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}

{% block subtitle %} {{ request.user }} {% endblock %}

{% block content %}

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="media">
                                <div class="mr-3">
                                    {% if request.user.profile_image %}
                                        <img src="{{ request.user.profile_image.url }}" alt=""
                                             class="avatar-md rounded-circle img-thumbnail">
                                    {% else %}
                                        <img src="{% static 'core/no-user.png' %}" alt=""
                                             class="avatar-md rounded-circle img-thumbnail">
                                    {% endif %}
                                </div>
                                <div class="media-body align-self-center">
                                    <div class="text-muted">
                                        <p class="mb-2">Welcome to Administration</p>
                                        <h5 class="mb-1">
                                            {% if request.user.first_name and request.user.last_name %}
                                                {{ request.user.first_name }} {{ request.user_last_name }}
                                            {% else %}
                                                {{ request.user.username }}
                                            {% endif %}
                                        </h5>
                                        <p class="mb-0 text-danger">
                                            {% if request.user.is_superuser %}
                                                Admin Access
                                            {% else %}
                                                Staff Access
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-8 align-self-center">
                            <div class="text-lg-center mt-4 mt-lg-0">
                                <div class="row text-center">
                                    <div class="col">
                                        <div>
                                            <p class="text-muted mb-0">
                                                <i class="fa fa-arrow-circle-up text-success"></i>

                                            </p>
                                            <small>Total</small>
                                            <h5 class="mt-2">$ {{ total_gained|intword }}</h5>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div>
                                            <p class="text-muted mb-0">
                                                <i class="fa fa-arrow-circle-up text-success"></i>

                                            </p>
                                            <small>Subscriptions</small>
                                            <h5 class="mt-2">$ {{ subscription_amount_total|intword }}</h5>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div>
                                            <p class="text-muted mb-2">
                                                <i class="fa fa-coins text-warning"></i>
                                                <br>
                                                <small>Tax</small>
                                            </p>
                                            <h5 class="mb-0">$ {{ amount_withdraw_count|intword }}</h5>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div>
                                            <p class="text-muted mb-2">
                                                <i class="fa fa-arrow-circle-down text-danger"></i>
                                                <br>
                                                <small>Withdrawals</small>
                                            </p>
                                            <h5 class="mb-0">$ {{ withdraw_amount_total|intword }}</h5>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div>
                                            {% if profit > 0 %}
                                                <p class="text-muted mb-2">
                                                    <i class="fa fa-arrow-alt-circle-up text-success"></i>
                                                    <br>
                                                    <small class="text-success">Profit</small>
                                                </p>
                                                <h5 class="mb-0 text-success">$ {{ profit|intword }}</h5>
                                            {% else %}
                                                <p class="text-muted mb-2">
                                                    <i class="fa fa-exclamation-triangle text-danger"></i>
                                                    <br>
                                                    <small class="text-danger">Loss</small>
                                                </p>
                                                <h5 class="mb-0 text-danger">$ {{ profit|intword }}</h5>
                                            {% endif %}
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                    <div class="row mt-5">
                        <div class="col-12">
                            <div id="main-chart">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {#REGISTRATIONS#}
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header bg-white border-bottom">
                    <p class="card-title mb-0">REGISTRATIONS</p>
                </div>
                <div class="card-body">
                    <div class="row text-center justify-content-center">
                        <div class="col">
                            <div class="text-muted">
                                <p class="mb-0">Total</p>
                                <p class="mb-2 small">Overall</p>
                                <h5 class="mb-0">{{ registrations_total|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-muted">
                                <p class="mb-0">Year</p>
                                <p class="mb-2 small">{% now 'Y' %}</p>
                                <h5 class="mb-0">{{ registrations_year|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-muted">
                                <p class="mb-0">Month</p>
                                <p class="mb-2 small">{% now 'M' %}</p>
                                <h5 class="mb-0">{{ registrations_month|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-muted">
                                <p class="mb-0">Today</p>
                                <p class="mb-2 small">{% now 'DATE_FORMAT' %}</p>
                                <h5 class="mb-0">{{ registrations_today|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div class="text-muted">
                                <p class="mb-0">Premium</p>
                                <p class="mb-2 small">Users</p>
                                <h5 class="mb-0">{{ registrations_paid|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="mb-0">Free</p>
                                <p class="mb-2 small">Users</p>
                                <h5 class="mb-0">{{ registrations_unpaid|intword }}</h5>
                            </div>
                        </div>
                        <div class="col border-left">
                            <div class="text-muted">
                                <p class="mb-0">Active</p>
                                <p class="mb-2 small">Today</p>
                                <h5 class="mb-0">{{ tasks_today|intword }}</h5>
                            </div>
                        </div>

                    </div>
                    <!-- end row -->
                </div>
            </div>
        </div>
    </div>

    {#SUBSCRIPTIONS#}
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header bg-white border-bottom">
                    <p class="card-title mb-0">SUBSCRIPTIONS</p>
                </div>
                <div class="card-body">
                    <div class="row justify-content-center text-center">
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Total</p>
                                <h5 class="mb-0">{{ subscriptions_total|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Year</p>
                                <h5 class="mb-0">{{ subscriptions_year|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Month</p>
                                <h5 class="mb-0">{{ subscriptions_month|intword }}</h5>

                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Today</p>
                                <h5 class="mb-0">{{ subscriptions_today|intword }}</h5>

                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Applied</p>
                                <h5 class="mb-0">{{ subscriptions_applied|intword }}</h5>

                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Approved</p>
                                <h5 class="mb-0">{{ subscriptions_approved|intword }}</h5>

                            </div>
                        </div>
                        <div class="col border-left">
                            <p class="text-truncate mb-2">
                                Subscriptions<br><small>Amount Today</small>
                            </p>
                            <h5 class="mb-0">
                                <b class="text-success">
                                    <i class="fa fa-arrow-circle-up"></i>$ {{ subscriptions_today_amount|intword }}
                                </b>
                            </h5>
                        </div>

                    </div>
                    <!-- end row -->
                </div>
            </div>
        </div>
    </div>

    {#WITHDRAWALS#}
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header bg-white border-bottom">
                    <p class="card-title mb-0">WITHDRAWALS</p>
                </div>
                <div class="card-body">

                    <div class="row justify-content-center text-center">
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Total</p>
                                <h5 class="mb-0">{{ withdrawals_total|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Year</p>
                                <h5 class="mb-0">{{ withdrawals_year|intword }}</h5>
                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Month</p>
                                <h5 class="mb-0">{{ withdrawals_month|intword }}</h5>

                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Today</p>
                                <h5 class="mb-0">{{ withdrawals_today|intword }}</h5>

                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Paid</p>
                                <h5 class="mb-0">{{ withdrawals_paid|intword }}</h5>

                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <p class="text-muted text-truncate mb-2">Pending</p>
                                <h5 class="mb-0">{{ withdrawals_pending|intword }}</h5>

                            </div>
                        </div>

                        <div class="col border-left">
                            <div>
                                <p class="text-truncate mb-2">
                                    Withdraw<br><small>Amount Today</small>
                                </p>
                                <h5 class="mb-0">
                                    <b class="text-danger">
                                        <i class="fa fa-arrow-circle-down"></i>$ {{ withdrawals_today_amount|intword }}
                                    </b> |
                                    <b class="text-warning">
                                        <i class="fa fa-coins"></i>$ {{ withdrawals_today|intword }}
                                    </b>
                                </h5>
                            </div>
                        </div>

                    </div>
                    <!-- end row -->
                </div>
            </div>
        </div>
    </div>

{% endblock %}


{% block js %}
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
{% endblock %}

{% block js_code %}
    <script>
        $(document).ready(function () {

            var options = {
                series: [
                    {
                        name: "Registrations",
                        data: {{ chart_registrations }}
                    },
                    {
                        name: "Profit",
                        data: {{ chart_profit }},
                    },
                    {
                        name: "Subscriptions",
                        data: {{ chart_subscriptions }}
                    },
                    {
                        name: "Withdraws",
                        data: {{ chart_withdrawals }}
                    },

                ],
                chart: {
                    height: 350,
                    type: 'line',
                    zoom: {
                        enabled: true
                    }
                },
                dataLabels: {
                    enabled: false,
                },
                stroke: {
                    curve: 'straight'
                },
                title: {
                    text: 'Monthly Report',
                    align: 'left'
                },
                grid: {
                    row: {
                        colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
                        opacity: 0.5
                    },
                },
                xaxis: {
                    categories: {{ chart_days }},
                }
            };

            var chart = new ApexCharts(document.querySelector("#main-chart"), options);
            chart.render();

        });

    </script>
{% endblock %}




